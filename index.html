from pathlib import Path

# 반영된 업데이트: 1인용/2인용 모드 선택, 피카츄 배구 스타일 키 설정 포함 (스파이크 포함)
updated_html = """
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>검 가챠 피카츄</title>
  <style>
    body { font-family: sans-serif; text-align: center; background-color: #f0f8ff; }
    .menu, .gacha, .vault, .game, .mode-select { display: none; margin-top: 20px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
    .visible { display: block; }
    img.logo { width: 300px; margin-top: 30px; }
    canvas { background: #fff; border: 2px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>
  <img src="long.png" alt="검 가챠 피카츄" class="logo">

  <div id="main-menu" class="menu visible">
    <button onclick="showModeSelect()">피카츄 배구</button>
    <button onclick="openGachaMenu()">검 뽑기</button>
  </div>

  <div id="mode-select" class="mode-select">
    <h3>게임 모드 선택</h3>
    <button onclick="startVolleyballGame('single')">1인용</button>
    <button onclick="startVolleyballGame('multi')">2인용</button>
    <button onclick="backToMain()">뒤로</button>
  </div>

  <div id="gacha-menu" class="menu">
    <button onclick="drawSword()">검 뽑기 (코인 15개)</button>
    <button onclick="showVault()">보관함</button>
    <button onclick="backToMain()">뒤로</button>
    <p id="coin-count">코인: 0</p>
    <p id="draw-result"></p>
  </div>

  <div id="vault" class="vault">
    <h3>보관함</h3>
    <div id="sword-list"></div>
    <button onclick="backToGacha()">뒤로</button>
  </div>

  <div id="game-canvas" class="game">
    <canvas id="volleyball" width="600" height="300"></canvas><br>
    <button onclick="endGame()">게임 종료</button>
  </div>

  <script>
    let coins = 0;
    let swords = [];
    let equippedSword = null;
    let gameMode = 'single';

    function showModeSelect() {
      document.getElementById("main-menu").classList.remove("visible");
      document.getElementById("mode-select").classList.add("visible");
    }

    function startVolleyballGame(mode) {
      gameMode = mode;
      document.getElementById("mode-select").classList.remove("visible");
      document.getElementById("game-canvas").classList.add("visible");
      startGame(mode);
    }

    function openGachaMenu() {
      document.getElementById("main-menu").classList.remove("visible");
      document.getElementById("gacha-menu").classList.add("visible");
    }

    function backToMain() {
      document.getElementById("gacha-menu").classList.remove("visible");
      document.getElementById("mode-select").classList.remove("visible");
      document.getElementById("main-menu").classList.add("visible");
    }

    function drawSword() {
      if (coins < 15) {
        alert("코인이 부족합니다!");
        return;
      }
      coins -= 15;
      const newSword = `검 ${Math.floor(Math.random() * 1000)}`;
      swords.push(newSword);
      document.getElementById("draw-result").textContent = `${newSword} 획득!`;
      document.getElementById("coin-count").textContent = `코인: ${coins}`;
    }

    function showVault() {
      document.getElementById("gacha-menu").classList.remove("visible");
      document.getElementById("vault").classList.add("visible");
      const list = document.getElementById("sword-list");
      list.innerHTML = swords.map((s, i) => `
        <div>
          <span>${s}</span>
          <button onclick="equipSword(${i})">장착</button>
        </div>
      `).join('');
    }

    function equipSword(index) {
      equippedSword = swords[index];
      alert(`${equippedSword} 장착 완료!`);
    }

    function backToGacha() {
      document.getElementById("vault").classList.remove("visible");
      document.getElementById("gacha-menu").classList.add("visible");
    }

    function endGame() {
      document.getElementById("game-canvas").classList.remove("visible");
      document.getElementById("main-menu").classList.add("visible");
    }

    function startGame(mode) {
      const canvas = document.getElementById("volleyball");
      const ctx = canvas.getContext("2d");
      let ball = { x: 300, y: 150, dx: 3, dy: 2, radius: 10 };
      let paddle1 = { x: 50, y: 260, vx: 0, vy: 0, width: 30, height: 30, jumping: false };
      let paddle2 = { x: 520, y: 260, vx: 0, vy: 0, width: 30, height: 30, jumping: false };
      const gravity = 0.5;
      const jumpPower = -10;
      let keys = {};

      document.onkeydown = e => keys[e.code] = true;
      document.onkeyup = e => keys[e.code] = false;

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw ball
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "orange";
        ctx.fill();

        // Ball movement
        ball.x += ball.dx;
        ball.y += ball.dy;

        if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) ball.dx *= -1;
        if (ball.y < ball.radius) ball.dy *= -1;
        if (ball.y > canvas.height - ball.radius) {
          alert("게임 종료!");
          if (gameMode === 'single') {
            const reward = Math.floor(Math.random() * 61) + 90;
            coins += reward;
            alert(`AI 승리! 코인 ${reward}개 획득!`);
          }
          endGame();
          return;
        }

        // Control paddles
        if (gameMode === 'multi') {
          if (keys["KeyA"]) paddle1.vx = -5;
          else if (keys["KeyD"]) paddle1.vx = 5;
          else paddle1.vx = 0;

          if (!paddle1.jumping && keys["KeyW"]) {
            paddle1.vy = jumpPower;
            paddle1.jumping = true;
          }
          if (keys["ShiftLeft"]) console.log("Player 1 Spike!");

          if (keys["ArrowLeft"]) paddle2.vx = -5;
          else if (keys["ArrowRight"]) paddle2.vx = 5;
          else paddle2.vx = 0;

          if (!paddle2.jumping && keys["ArrowUp"]) {
            paddle2.vy = jumpPower;
            paddle2.jumping = true;
          }
          if (keys["Enter"]) console.log("Player 2 Spike!");
        } else {
          // 1인용: Player controls paddle1, AI controls paddle2
          paddle1.vx = keys["KeyA"] ? -5 : keys["KeyD"] ? 5 : 0;
          if (!paddle1.jumping && keys["KeyW"]) {
            paddle1.vy = jumpPower;
            paddle1.jumping = true;
          }
          if (keys["ShiftLeft"]) console.log("Player 1 Spike!");

          // AI: move toward ball
          if (ball.x > paddle2.x + paddle2.width / 2) paddle2.vx = 2;
          else if (ball.x < paddle2.x + paddle2.width / 2) paddle2.vx = -2;
          else paddle2.vx = 0;
        }

        [paddle1, paddle2].forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += gravity;
          if (p.y > 260) {
            p.y = 260;
            p.vy = 0;
            p.jumping = false;
          }
          ctx.fillStyle = "blue";
          ctx.fillRect(p.x, p.y, p.width, p.height);
        });

        requestAnimationFrame(draw);
      }

      draw();
    }
  </script>
</body>
</html>
"""

# Save the final HTML
file_path = Path("/mnt/data/index.html")
file_path.write_text(updated_html, encoding="utf-8")

file_path.name
